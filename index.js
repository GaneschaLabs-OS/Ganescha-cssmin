var _compressHexColors=function(e){for(var r,_=/(\=\s*?["']?)?#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])(\}|[^0-9a-f{][^{]*?\})/gi,a=0,s=[];null!==(r=_.exec(e));)s.push(e.substring(a,r.index)),r[1]?s.push(r[1]+"#"+(r[2]+r[3]+r[4]+r[5]+r[6]+r[7])):r[2].toLowerCase()===r[3].toLowerCase()&&r[4].toLowerCase()===r[5].toLowerCase()&&r[6].toLowerCase()===r[7].toLowerCase()?s.push("#"+(r[3]+r[5]+r[7]).toLowerCase()):s.push("#"+(r[2]+r[3]+r[4]+r[5]+r[6]+r[7]).toLowerCase()),a=_.lastIndex=_.lastIndex-r[8].length;return s.push(e.substring(a)),s.join("")},_extractDataUrls=function(e,r){for(var _,a,s,t,n,o,l,i=e.length-1,c=0,g=[],p=/url\(\s*(["']?)data\:/g;null!==(n=p.exec(e));){for(_=n.index+4,0===(s=n[1]).length&&(s=")"),t=!1,a=p.lastIndex-1;!1===t&&a+1<=i;)(a=e.indexOf(s,a+1))>0&&"\\"!==e.charAt(a-1)&&(t=!0,")"!==s&&(a=e.indexOf(")",a)));g.push(e.substring(c,n.index)),t?(l=(l=e.substring(_,a)).replace(/\s+/g,""),r.push(l),o="url(___YUICSSMIN_PRESERVED_TOKEN_"+(r.length-1)+"___)",g.push(o),c=a+1):(g.push(e.substring(n.index,p.lastIndex)),c=p.lastIndex)}return g.push(e.substring(c)),g.join("")};function cssmin(e,r){var _=0,a=0,s=0,t=0,n=[],o=[],l="",i=e.length,c="";for(e=_extractDataUrls(e,n);(_=e.indexOf("/*",_))>=0;)(a=e.indexOf("*/",_+2))<0&&(a=i),l=e.slice(_+2,a),o.push(l),e=e.slice(0,_+2)+"___YUICSSMIN_PRESERVE_CANDIDATE_COMMENT_"+(o.length-1)+"___"+e.slice(a),_+=2;for(e=e.replace(/("([^\\"]|\\.|\\)*")|('([^\\']|\\.|\\)*')/g,function(e){var r,_,a=e.substring(0,1);if((e=e.slice(1,-1)).indexOf("___YUICSSMIN_PRESERVE_CANDIDATE_COMMENT_")>=0)for(r=0,_=o.length;r<_;r+=1)e=e.replace("___YUICSSMIN_PRESERVE_CANDIDATE_COMMENT_"+r+"___",o[r]);return e=e.replace(/progid:DXImageTransform\.Microsoft\.Alpha\(Opacity=/gi,"alpha(opacity="),n.push(e),a+"___YUICSSMIN_PRESERVED_TOKEN_"+(n.length-1)+"___"+a}),s=0,t=o.length;s<t;s+=1)c="___YUICSSMIN_PRESERVE_CANDIDATE_COMMENT_"+s+"___","!"!==(l=o[s]).charAt(0)?"\\"!==l.charAt(l.length-1)?(0===l.length&&(_=e.indexOf(c))>2&&">"===e.charAt(_-3)&&(n.push(""),e=e.replace(c,"___YUICSSMIN_PRESERVED_TOKEN_"+(n.length-1)+"___")),e=e.replace("/*"+c+"*/","")):(n.push("\\"),e=e.replace(c,"___YUICSSMIN_PRESERVED_TOKEN_"+(n.length-1)+"___"),s+=1,n.push(""),e=e.replace("___YUICSSMIN_PRESERVE_CANDIDATE_COMMENT_"+s+"___","___YUICSSMIN_PRESERVED_TOKEN_"+(n.length-1)+"___")):(n.push(l),e=e.replace(c,"___YUICSSMIN_PRESERVED_TOKEN_"+(n.length-1)+"___"));if(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/\s+/g," ")).replace(/(^|\})(([^\{:])+:)+([^\{]*\{)/g,function(e){return e.replace(/\:/g,"___YUICSSMIN_PSEUDOCLASSCOLON___")})).replace(/\s+([!{};:>+\(\)\],])/g,"$1")).replace(/___YUICSSMIN_PSEUDOCLASSCOLON___/g,":")).replace(/:first-(line|letter)(\{|,)/g,":first-$1 $2")).replace(/\*\/ /g,"*/")).replace(/^(.*)(@charset "[^"]*";)/gi,"$2$1")).replace(/^(\s*@charset [^;]+;\s*)+/gi,"$1")).replace(/\band\(/gi,"and (")).replace(/([!{}:;>+\(\[,])\s+/g,"$1")).replace(/;+\}/g,"}")).replace(/([\s:])(0)(px|em|%|in|cm|mm|pc|pt|ex)/gi,"$1$2")).replace(/:0 0 0 0(;|\})/g,":0$1")).replace(/:0 0 0(;|\})/g,":0$1")).replace(/:0 0(;|\})/g,":0$1")).replace(/(background-position|transform-origin|webkit-transform-origin|moz-transform-origin|o-transform-origin|ms-transform-origin):0(;|\})/gi,function(e,r,_){return r.toLowerCase()+":0 0"+_})).replace(/(:|\s)0+\.(\d+)/g,"$1.$2")).replace(/rgb\s*\(\s*([0-9,\s]+)\s*\)/gi,function(){var e,r=arguments[1].split(",");for(e=0;e<r.length;e+=1)r[e]=parseInt(r[e],10).toString(16),1===r[e].length&&(r[e]="0"+r[e]);return"#"+r.join("")}),e=(e=(e=(e=_compressHexColors(e)).replace(/(border|border-top|border-right|border-bottom|border-right|outline|background):none(;|\})/gi,function(e,r,_){return r.toLowerCase()+":0"+_})).replace(/progid:DXImageTransform\.Microsoft\.Alpha\(Opacity=/gi,"alpha(opacity=")).replace(/[^\};\{\/]+\{\}/g,""),r>=0)for(_=0,s=0;s<e.length;)"}"===e[(s+=1)-1]&&s-_>r&&(e=e.slice(0,s)+"\n"+e.slice(s),_=s);for(e=e.replace(/;;+/g,";"),s=0,t=n.length;s<t;s+=1)e=e.replace("___YUICSSMIN_PRESERVED_TOKEN_"+s+"___",n[s]);return e=e.replace(/^\s+|\s+$/g,"")}exports.cssmin=cssmin;
